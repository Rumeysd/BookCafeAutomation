<div class="card custom-card">
  <div class="card-header border-0 bg-transparent py-3">
    <div class="row align-items-center">
      <div class="col">
        <h4 class="card-title fw-bold text-dark m-0">
          <i class="fa fa-book-open me-2 text-primary"></i>Kitap Koleksiyonu
        </h4>
      </div>
      <div class="col-auto">
        <button id="create" class="btn btn-soft-primary shadow-sm" type="button" (click)="createBook()">
          <i class="fa fa-plus-circle me-1"></i>
          <span>{{ 'NewBook' | abpLocalization }}</span>
        </button>
      </div>
    </div>
  </div>

  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0 custom-table">
        <thead>
          <tr>
            <th class="ps-4">Kitap</th>
            <th>Yazar</th>
            <th>Kategori</th>
            <th class="text-center">Sayfa</th>
            <th class="text-center">Durum</th>
            <th class="text-end pe-4">İşlemler</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let book of bookList.items">
            <td class="ps-4">
              <div class="detail-image-box shadow-sm rounded mb-3 overflow-hidden">
                <img *ngIf="bookImageUrl; else noImage" [src]="bookImageUrl"
                  class="img-fluid object-fit-cover w-100 h-100" />
                <ng-template #noImage>
                  <i class="fa fa-book fa-5x text-light-gray"></i>
                </ng-template>
              </div>
            </td>

            <td class="text-secondary">{{ book.authorName }}</td>

            <td>
              <span class="badge badge-soft-info">{{ book.categoryName }}</span>
            </td>

            <td class="text-center text-muted small">{{ book.pageCount }}</td>

            <td class="text-center">
              <span class="status-badge" [ngClass]="book.status === 0 ? 'status-available' : 'status-busy'">
                <i class="fa fa-circle me-1 small"></i>
                {{ (book.status === 0 ? '::Status:Available' : '::Status:Unavailable') | abpLocalization }}
              </span>
            </td>

            <td class="text-end pe-4">
              <div class="btn-group shadow-sm border rounded-pill overflow-hidden">
                <button class="btn-action view-btn" (click)="openDetails(book)">
                  <i class="fa fa-eye"></i>
                </button>

                <button class="btn-action delete-btn" (click)="deleteBook(book)">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<app-create-book #createBookModal (onSave)="refreshList()"></app-create-book>

<abp-modal [(visible)]="isDetailsModalOpen">
  <ng-template #abpHeader>
    <h3 class="m-0 text-dark"><i class="fa fa-info-circle me-2"></i>Kitap Detayları</h3>
  </ng-template>

  <ng-template #abpBody>
    <div class="row align-items-center py-3" *ngIf="selectedBook">
      <div class="col-md-4 text-center">
        <div class="detail-image-box shadow-sm rounded mb-3">
          <i class="fa fa-book fa-5x text-light-gray"></i>
        </div>
      </div>
      <div class="col-md-8">
        <h4 class="fw-bold mb-1">{{ selectedBook.name }}</h4>
        <p class="text-primary mb-3">{{ selectedBook.authorName }}</p>

        <ul class="list-group list-group-flush border-top border-bottom py-2">
          <li class="list-group-item d-flex justify-content-between px-0 bg-transparent border-0">
            <span class="text-muted">Kategori:</span>
            <span class="fw-bold">{{ selectedBook.categoryName }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between px-0 bg-transparent border-0">
            <span class="text-muted">Sayfa Sayısı:</span>
            <span class="fw-bold">{{ selectedBook.pageCount }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between px-0 bg-transparent border-0">
            <span class="text-muted">Durum:</span>
            <span class="fw-bold text-success">{{ getStatusLabel(selectedBook.status) | abpLocalization }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between px-0 bg-transparent border-0">
            <span class="text-muted">QR Kodu:</span>
            <code class="fw-bold text-dark">{{ selectedBook.qrCode || '---' }}</code>
          </li>
        </ul>
      </div>
    </div>
  </ng-template>

  <ng-template #abpFooter>
    <button type="button" class="btn btn-soft-secondary" abpClose>Kapat</button>
  </ng-template>
</abp-modal>